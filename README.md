Сервис синхронизации треков из Garmin Connect в OpenStreetMap
Это руководство поможет вам запустить сервис в Docker-контейнере.
Структура проекта
Для начала создайте папку для вашего проекта и поместите в нее все файлы со следующей структурой:
garmin-osm-sync/
├── Dockerfile
├── main.py
├── requirements.txt
└── crontab


Шаг 1: Сборка Docker-образа
Откройте терминал или командную строку.
Перейдите в корневую папку вашего проекта (garmin-osm-sync).
Выполните команду для сборки образа. Она создаст Docker-образ с именем garmin-osm-sync на основе вашего Dockerfile.
docker build -t garmin-osm-sync .


Шаг 2: Запуск Docker-контейнера
Это самый важный шаг. Мы запускаем контейнер из созданного образа и передаем ваши учетные данные через переменные окружения (-e). Это безопасный способ передавать секреты в контейнер, не сохраняя их в коде или Docker-образе.
Выполните команду ниже, подставив свои реальные данные:
docker run -d --name garmin-sync-service \
  -e GARMIN_EMAIL="ВАШ_EMAIL@garmin.com" \
  -e GARMIN_PASSWORD="ВАШ_ПАРОЛЬ_GARMIN" \
  -e OSM_USERNAME="ВАШ_ЛОГИН_OSM" \
  -e OSM_PASSWORD="ВАШ_ПАРОЛЬ_OSM" \
  --restart unless-stopped \
  garmin-osm-sync


Разбор параметров команды:
docker run: команда для запуска контейнера.
-d: запускает контейнер в фоновом режиме (detached mode).
--name garmin-sync-service: присваивает контейнеру понятное имя.
-e КЛЮЧ="ЗНАЧЕНИЕ": устанавливает переменную окружения внутри контейнера.
--restart unless-stopped: автоматически перезапускает контейнер при перезагрузке системы или в случае сбоя (кроме случаев, когда он был остановлен вручную).
garmin-osm-sync: имя образа, который мы собрали на предыдущем шаге.
Шаг 3: Проверка работы и просмотр логов
После запуска контейнера скрипт main.py будет выполняться по расписанию, заданному в файле crontab (в нашем случае — каждые 6 часов).
Чтобы посмотреть, что происходит внутри контейнера и как выполняется ваш скрипт, используйте команду для просмотра логов:
docker logs -f garmin-sync-service


Ключ -f позволяет следить за логами в реальном времени. Нажмите Ctrl+C, чтобы выйти из режима просмотра.
При первом запуске вы должны увидеть сообщения о попытке входа, поиске активностей и их синхронизации. При последующих запусках, если новых активностей нет, вы увидите соответствующее сообщение.
Управление контейнером
Остановить сервис:
docker stop garmin-sync-service


Запустить остановленный сервис:
docker start garmin-sync-service


Удалить сервис (сначала нужно его остановить):
docker rm garmin-sync-service


